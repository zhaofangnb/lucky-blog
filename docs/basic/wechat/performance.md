# 性能
小程序启动往往会遇到白屏、正在加载等场景，这是因为首次(冷启动)前,微信会为小程序准备好通用的运行环境，如运行中的线程和一些基础库的初始化,如下：
+ **下载小程序代码包**
+ **加载小程序代码包**
+ **初始化小程序首页**

ps: 下载到的小程序代码包不是小程序的源代码，而是`编译、压缩、打包之后的代码包`
![](/wechat/preload.png)

## 提高应用速度的两个手段
围绕以上启动流程，可以从`加载`,`渲染`两个角度进行优化

### 加载
一、控制小程序包的大小：
+ 代码包的体积压缩可以通过勾选开发者工具中"上传代码时，压缩代码"选项
+ 及时清理无用的代码和资源
+ 减少资源包中的图片等资源的数量和大小（理论上除了小icon，其他图片资源从网络下载），图片资源压缩率有限


二、采取分包加载的操作，将用户访问率高的页面放在主包里，将访问率低的页面放在子包里，按需加载
<br/>
子包不宜拆的太大，防止有明显的卡顿，可以采用子包预加载技术
<br/>
![](/wechat/prepack.png)

### 渲染

一、关于**首屏渲染优化**的手段如下：
+ 请求可以在页面`onLoad()`就加载，不需要等页面`ready`后再异步请求数据
+ 尽量`减少不必要的https请求`,可使用`getStorageSync()`和`setStorageSync()`方法将数据存储在本地
+ 可以将前置页面一些有用的数据带到当前页，（如：列表页的某些数据-->>详情页）没有数据的模块可以进行`骨架屏的占位`

二、在微信小程序中，**提高页面的多次渲染效率**主要在于正确使用setData()：
+ 不要频繁调用`setData()`,应考虑将多次`setData()`合并成一次`setData()`调用
+ 数据通信的性能与数据量正相关，有一些数据字段不在界面中展示且数据结构比较复杂或包含长字符串时，则不应使用`setData()`来设置这些数据
+ 与界面渲染无关的数据最好不要设置在data中，可以考虑设置在page对象的其他字段下

三、对于一些**独立的模块我们尽可能抽离出来**，这是因为自定义组件的更新并不会影响页面上其他元素的更新


## 总结
「小程序启动加载性能」：

+ 控制代码包的大小
+ 分包加载
+ 首屏体验（预请求，利用缓存，避免白屏，及时反馈

「小程序渲染性能」：

+ 避免不当的使用setData
+ 使用自定义组件